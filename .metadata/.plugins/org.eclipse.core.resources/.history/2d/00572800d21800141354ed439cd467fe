package com.example.android_rspeak_v1.transactions;

import java.util.HashMap;

import org.json.JSONObject;

import android.content.Context;

import com.example.android_rspeak_v1.database.HTTPRequest;
import com.example.android_rspeak_v1.database.HTTPRequestsDataSource;

public class RegisterGCMTransaction 
{
	private Context context;
	private HTTPRequest request;
	GCMManager gcmManager;
	
	public RegisterGCMTransaction( Context context )
	{
		this.context = context;
		this.gcmManager = new GCMManager( context );
	}
	
	public void beginTransaction()
	{
		// then create the JSON object for the http request
		HashMap<String, String> params = new HashMap<String, String>();
	    params.put( HTTPRequest.DATA_DEVICE_ID, device_id );
	    params.put( HTTPRequest.DATA_PUSH_NOTIFICATION_ID, push_notificaiton_id_string );
	    JSONObject request_data = new JSONObject(params);
		
		// then add the question request to the database
		HTTPRequestsDataSource requestSource = new HTTPRequestsDataSource( context );
		requestSource.open();
		this.request = requestSource.createRequest( HTTPRequest.Type.POST, HTTPRequest.BASE_URL + HTTPRequest.URL_REGISTER_PUSH_NOTIFICATION_ID, request_data.toString() );
		requestSource.close();
		
		// then try to send the request to the server
		request.startRequest( successListener(), errorListener() );
	}
}
